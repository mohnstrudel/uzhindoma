-@order.errors.full_messages.each do |message|
  =content_tag(:div, message, class: "alert alert-danger")

-if user_signed_in?
  %main.page-content
    =form_for @order do |f|
      .row
        %section
          %h3.zero-letter-spacing Оформление заказа
          .col-xs-12.col-md-10.col-md-offset-1
            %h5.zero-letter-spacing.text-left.margin-top-30.extra-small
              ="Здравствуйте, #{@cu.first_name}"
            %h5.zero-letter-spacing.text-left.margin-top-30.extra-small
              Куда доставляем заказ?
            .row
              .col-md-5
                =select_tag :delivery_address, options_for_select([[@order.address, "current"]] + Order.get_addresses(current_user) + [["Добавить новый адрес", "new"]]), class: 'form-control'
                / =f.text_field :address, placeholder: "Текущий адрес", class: "uzhindoma-universal-input"
            .optional_address_block.hidden
              .row
                .col-md-4
                  %h5.zero-letter-spacing.text-left.margin-top-30.extra-small{:for => "standard_order_phone"} Москва или область?
                  .margin-top-15
                  #region_input
                    .col-md-6.no-left-padding-margin.text-left
                      .radio-wrapper
                        .uzhin_rb_menus
                          =f.radio_button :delivery_region, "Москва", hidden: true, id: "delivery_region_1"
                          %label{id: "delivery_region_1", :for => "delivery_region_1"} Москва
                    .col-md-6.no-right-padding-margin.text-right
                      .radio-wrapper
                        .uzhin_rb_menus
                          =f.radio_button :delivery_region, "Московская область", hidden: true, id: "delivery_region_2"
                          %label{id: "delivery_region_2", :for => "delivery_region_2"} Московская область
              
              .row
                .col-md-6
                  #city_input      
                    .text-wrapper
                      %label.h5.zero-letter-spacing.text-left.extra-small{:for => "street"} Город
                      .uzhindoma-input
                        =f.text_field :city, data: { constraints: "@NotEmpty"}, id: "street", value: ""
              .row
                .col-md-6
                  #street_input
                    .text-wrapper
                      %label.h5.zero-letter-spacing.text-left.extra-small{:for => "street"} Улица
                      .uzhindoma-input
                        =f.text_field :street, data: { constraints: "@NotEmpty"}, id: "street"
              .row
                .col-md-6
                  #house_input
                    .text-wrapper
                      %label.h5.zero-letter-spacing.text-left.extra-small{:for => "house_number"} Дом
                      .uzhindoma-input
                        =f.text_field :house_number, data: { constraints: "@NotEmpty"}, id: "house_number"
              .row  
                .col-md-6
                  #flat_input
                    .text-wrapper
                      %label.h5.zero-letter-spacing.text-left.extra-small{:for => "flat_number"} Квартира
                      .uzhindoma-input
                        =f.text_field :flat_number, data: { constraints: "@NotEmpty"}, id: "flat_number"

              .row  
                .col-md-6
                  #add_address_input
                    .text-wrapper
                      %label.h5.zero-letter-spacing.text-left.extra-small{:for => "flat_number"} Подъезд, Этаж, Код домофона
                      .uzhindoma-input
                        =f.text_field :additional_address, data: { constraints: "@NotEmpty"}, id: "flat_number"
            .row
              .col-md-5
                %h5.zero-letter-spacing.margin-top-30.text-left.extra-small Интервал доставки
                .row
                #delivery-container
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "9:00 - 12:00", hidden: true, id: "delivery_timeframe1"
                      %label{id: "delivery_timeframe1", :for => "delivery_timeframe1"} 9:00 - 12:00
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "11:00 - 14:00", hidden: true, id: "delivery_timeframe2"
                      %label{id: "delivery_timeframe2", :for => "delivery_timeframe2"} 11:00 - 14:00
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "17:00 - 20:00", hidden: true, id: "delivery_timeframe3"
                      %label{id: "delivery_timeframe3", :for => "delivery_timeframe3"} 17:00 - 20:00
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "20:00 - 23:00", hidden: true, id: "delivery_timeframe4"
                      %label{id: "delivery_timeframe4", :for => "delivery_timeframe4"} 20:00 - 23:00
                  %span.stretch
            .row
              .col-md-5
                %label.h5.zero-letter-spacing.text-left.extra-small{:for => "area"} Комментарии к заказу
                =f.text_area :comment, id: "area", cols: "50", rows: 3, placeholder: "Напишите здесь, если хотите заменить свинину на курицу в стандартном меню.\n\rТакже здесь можно указать просьбу не звонить в дверь, дополнительный номер телефона, пожелания и вопросы к заказу"
            .row
              .col-md-5
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "street"} Промокод
                  .uzhindoma-input
                    =f.text_field :pcode, id: "promocode", placeholder: "Промокод (уточнаяйте у мендежера) на скидку 500 рублей."

            / Some hidden fields to set up order values
            =f.hidden_field :menu_id, value: @menu.id
            =f.hidden_field :menu_type, value: @menu.category.name
            =f.hidden_field :order_price, value: @menu_price
            =f.hidden_field :order_type, value: "normal"
            =f.hidden_field :payed_online, value: false
            =f.hidden_field :phone, value: @cu.phone
            =f.hidden_field :email, value: @cu.email
            =f.hidden_field :address, value: @cu.address
            =f.hidden_field :additional_address, value: @cu.additional_address
            =f.hidden_field :first_name, value: @cu.first_name
            
            -if params[:person_amount_0]
              =f.hidden_field :person_amount, value: parse_checkbox_array_params(params[:person_amount_0])
            -elsif params[:person_amount_1]
              =f.hidden_field :person_amount, value: parse_checkbox_array_params(params[:person_amount_1])
            -else
              =f.hidden_field :person_amount, value: parse_checkbox_array_params(params[:person_amount])
            
            -if params[:menu_amount_0]
              =f.hidden_field(:menu_amount, value: parse_checkbox_array_params(params[:menu_amount_0]))
            -elsif params[:menu_amount_1]
              =f.hidden_field(:menu_amount, value: parse_checkbox_array_params(params[:menu_amount_1]))
            -else
              =f.hidden_field(:menu_amount, value: parse_checkbox_array_params(params[:menu_amount]))
            / =f.hidden_field(:menu_amount, value: params[:menu_amount_1].to_i) unless params[:menu_amount_1].empty?

            
            -if params[:add_dessert_0]
              =f.hidden_field :add_dessert, value: params[:add_dessert_0]
            -elsif params[:add_dessert_1]
              =f.hidden_field :add_dessert, value: params[:add_dessert_1]
            -else
              =f.hidden_field :add_dessert, value: params[:add_dessert]
            =f.hidden_field :change, value: params[:change]
            
            .row.margin-top-30
              .col-md-8.text-right
                .submit-order
                  =f.submit "Перейти к оплате", class: "btn btn-success-mod-uzhindoma margin-bottom-60"
                        

-else
  %main.page-content
    =form_for @order do |f|
      .row
        %section
          %h3.zero-letter-spacing Оформление заказа
          .col-md-10.col-md-offset-1.margin-top-30
            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "first_name"} Имя
                  .uzhindoma-input
                    =f.text_field :first_name, data: { constraints: "@NotEmpty"}, id: "first_name", required: ""

            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "second_name"} Фамилия
                  .uzhindoma-input
                    =f.text_field :second_name, data: { constraints: "@NotEmpty"}, id: "second_name", required: ""
            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "email"} E-mail
                  .uzhindoma-input
                    =f.text_field :email, data: { constraints: "@NotEmpty @Email"}, id: "email", required: ""
            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "standard_order_phone"} Телефон
                  .uzhindoma-input
                    =f.text_field :phone, data: { constraints: "@Phone"}, id: "standard_order_phone", required: "", value: params[:phone]
            .row
              .col-md-4
                %h5.zero-letter-spacing.text-left.margin-top-30.extra-small{:for => "standard_order_phone"} Москва или область?
                .margin-top-15
                .col-md-6.no-left-padding-margin.text-left
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_region, "Москва", hidden: true, id: "delivery_region_1"
                      %label{id: "delivery_region_1", :for => "delivery_region_1"} Москва
                .col-md-6.no-right-padding-margin.text-right
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_region, "Московская область", hidden: true, id: "delivery_region_2"
                      %label{id: "delivery_region_2", :for => "delivery_region_2"} Московская область
            #city_input
              .row
                .col-md-6
                  .text-wrapper
                    %label.h5.zero-letter-spacing.text-left.extra-small{:for => "street"} Город
                    .uzhindoma-input
                      =f.text_field :city, data: { constraints: "@NotEmpty"}, id: "street", value: ""

            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "street"} Улица
                  .uzhindoma-input
                    =f.text_field :street, data: { constraints: "@NotEmpty"}, id: "street", required: ""
            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "house_number"} Дом
                  .uzhindoma-input
                    =f.text_field :house_number, data: { constraints: "@NotEmpty"}, id: "house_number", required: ""
            .row  
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "flat_number"} Квартира
                  .uzhindoma-input
                    =f.text_field :flat_number, data: { constraints: "@NotEmpty"}, id: "flat_number", required: ""

            .row  
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "flat_number"} Подъезд, Этаж, Код домофона
                  .uzhindoma-input
                    =f.text_field :additional_address, data: { constraints: "@NotEmpty"}, id: "flat_number", required: ""

            .row
              .col-md-6
                %label.h5.zero-letter-spacing.text-left.extra-small{:for => "delivery_timeframe"}  Интервал доставки
                #delivery-container
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "9:00 - 12:00", hidden: true, id: "delivery_timeframe1"
                      %label{id: "delivery_timeframe1", :for => "delivery_timeframe1"} 9:00 - 12:00
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "11:00 - 14:00", hidden: true, id: "delivery_timeframe2"
                      %label{id: "delivery_timeframe2", :for => "delivery_timeframe2"} 11:00 - 14:00
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "17:00 - 20:00", hidden: true, id: "delivery_timeframe3"
                      %label{id: "delivery_timeframe3", :for => "delivery_timeframe3"} 17:00 - 20:00
                  .radio-wrapper
                    .uzhin_rb_menus
                      =f.radio_button :delivery_timeframe, "20:00 - 23:00", hidden: true, id: "delivery_timeframe4"
                      %label{id: "delivery_timeframe4", :for => "delivery_timeframe4"} 20:00 - 23:00
                  %span.stretch

            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.margin-top-30.extra-small{:for => "area"} Комментарии к заказу
                  =f.text_area :comment, id: "area", cols: "50", rows: 5, placeholder: "Напишите здесь, если хотите заменить свинину на курицу в стандартном меню.\n\rТакже здесь можно указать просьбу не звонить в дверь, дополнительный номер телефона, пожелания и вопросы к заказу"

            .row
              .col-md-6
                .text-wrapper
                  %label.h5.zero-letter-spacing.text-left.extra-small{:for => "street"} Промокод
                  .uzhindoma-input
                    =f.text_field :pcode, id: "promocode", placeholder: "Промокод (уточнаяйте у мендежера) на скидку 500 рублей."

            .row
              .col-md-6.text-left
                Для Вашего удобства с введенными данными мы создадим для Вас учетную запись на нашем сайте. При последующих заказах вы сможете войти в систему, введя свой телефон (пароль придет по смс на указанный номер).

            / Some hidden fields to set up order values
            =f.hidden_field :menu_id, value: @menu.id
            =f.hidden_field :menu_type, value: @menu.category.name
            =f.hidden_field :order_price, value: @menu_price
            =f.hidden_field :order_type, value: "normal"
            / =f.hidden_field :payed_online, value: false
            
            -if params[:person_amount_0]
              =f.hidden_field :person_amount, value: parse_checkbox_array_params(params[:person_amount_0])
            -elsif params[:person_amount_1]
              =f.hidden_field :person_amount, value: parse_checkbox_array_params(params[:person_amount_1])
            
            -if params[:menu_amount_0]
              =f.hidden_field(:menu_amount, value: parse_checkbox_array_params(params[:menu_amount_0]))
            -elsif params[:menu_amount_1]
              =f.hidden_field(:menu_amount, value: parse_checkbox_array_params(params[:menu_amount_1]))
            / =f.hidden_field(:menu_amount, value: params[:menu_amount_1].to_i) unless params[:menu_amount_1].empty?

            =f.hidden_field :add_dessert, value: params[:add_dessert_0]
            =f.hidden_field :change, value: params[:change]
            
            .row
              .col-md-6.text-right
                .submit-order
                  =f.submit "Перейти к оплате", class: "btn btn-success-mod-uzhindoma margin-bottom-60"
                        
